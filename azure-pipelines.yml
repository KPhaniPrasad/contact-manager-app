trigger:
- main

pool:
  vmImage: ubuntu-latest

variables:
  acrLoginServer: mycontactmanager.azurecr.io            # Replace with your ACR login server
  imageNameFrontend: contact-frontend
  imageNameBackend: contact-backend

steps:
# Optional: Install Docker if needed
- task: DockerInstaller@0

# Login to Azure Container Registry
- task: Docker@2
  displayName: Login to ACR
  inputs:
    command: login
    containerRegistry: azure-contact-manager-app          # Replace with your Azure DevOps service connection name

# Build backend image
- task: Docker@2
  displayName: Build backend image
  inputs:
    command: build
    Dockerfile: backend/Dockerfile
    tags: |
      $(acrLoginServer)/$(imageNameBackend):$(Build.BuildId)
    buildContext: $(Build.SourcesDirectory)/backend

# Build frontend image
- task: Docker@2
  displayName: Build frontend image
  inputs:
    command: build
    Dockerfile: frontend/Dockerfile
    tags: |
      $(acrLoginServer)/$(imageNameFrontend):$(Build.BuildId)
    buildContext: $(Build.SourcesDirectory)/frontend

# Push backend image
- task: Docker@2
  displayName: Push backend image
  inputs:
    command: push
    tags: |
      $(acrLoginServer)/$(imageNameBackend):$(Build.BuildId)

# Push frontend image
- task: Docker@2
  displayName: Push frontend image
  inputs:
    command: push
    tags: |
      $(acrLoginServer)/$(imageNameFrontend):$(Build.BuildId)
